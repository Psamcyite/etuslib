{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/blackmonk/GitHub/etusmail/app/%28auth%29/sign-in/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(auth)/sign-in/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(auth)/sign-in/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA+R,GAC5T,6DACA"}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///home/blackmonk/GitHub/etusmail/app/%28auth%29/sign-in/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(auth)/sign-in/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(auth)/sign-in/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2Q,GACxS,yCACA"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 51, "column": 0}, "map": {"version":3,"sources":["file:///home/blackmonk/GitHub/etusmail/database/redis.ts"],"sourcesContent":["import { Redis } from \"@upstash/redis\";\nimport config from \"../lib/config\";\n\nconst redis = new Redis({\n  url: config.env.upstash.redisUrl,\n  token: config.env.upstash.redisToken,\n});\n\nexport default redis;\n"],"names":[],"mappings":";;;AAAA;AACA;AADA;;;AAGA,MAAM,QAAQ,IAAI,6JAAA,CAAA,QAAK,CAAC;IACtB,KAAK,6GAAA,CAAA,UAAM,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ;IAChC,OAAO,6GAAA,CAAA,UAAM,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU;AACtC;uCAEe"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///home/blackmonk/GitHub/etusmail/lib/ratelimit.ts"],"sourcesContent":["import { Ratelimit } from \"@upstash/ratelimit\";\nimport redis from \"../database/redis\";\n\nconst ratelimit = new Ratelimit({\n  redis,\n  limiter: Ratelimit.fixedWindow(5, \"1m\"),\n  analytics: true,\n  prefix: \"@upstash/ratelimit\",\n});\n\nexport default ratelimit;\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,YAAY,IAAI,uJAAA,CAAA,YAAS,CAAC;IAC9B,OAAA,iHAAA,CAAA,UAAK;IACL,SAAS,uJAAA,CAAA,YAAS,CAAC,WAAW,CAAC,GAAG;IAClC,WAAW;IACX,QAAQ;AACV;uCAEe"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///home/blackmonk/GitHub/etusmail/lib/actions/auth.ts"],"sourcesContent":["\"use server\";\n\nimport { eq } from \"drizzle-orm\";\nimport { db } from \"../../database/drizzle\";\nimport { users } from \"../../database/schema\";\nimport { hash } from \"bcryptjs\";\nimport { signIn } from \"../../auth\";\nimport { headers } from \"next/headers\";\nimport ratelimit from \"../../lib/ratelimit\";\nimport { redirect } from \"next/navigation\";\n//import { workflowClient } from \"@/lib/workflow\";\nimport config from \"../../lib/config\";\n\nexport const signInWithCredentials = async (\n  params: Pick<AuthCredentials, \"email\" | \"password\">,\n) => {\n  const { email, password } = params;\n\n  const ip = (await headers()).get(\"x-forwarded-for\") || \"127.0.0.1\";\n  const { success } = await ratelimit.limit(ip);\n\n  if (!success) return redirect(\"/too-fast\");\n\n  try {\n    const result = await signIn(\"credentials\", {\n      email,\n      password,\n      redirect: false,\n    });\n\n    if (result?.error) {\n      return { success: false, error: result.error };\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.log(error, \"Signin error\");\n    return { success: false, error: \"Signin error\" };\n  }\n};\n\nexport const signUp = async (params: AuthCredentials) => {\n  const { fullName, email, universityId, password, universityCard } = params;\n\n  const ip = (await headers()).get(\"x-forwarded-for\") || \"127.0.0.1\";\n  const { success } = await ratelimit.limit(ip);\n\n  if (!success) return redirect(\"/too-fast\");\n\n  const existingUser = await db\n    .select()\n    .from(users)\n    .where(eq(users.email, email))\n    .limit(1);\n\n  if (existingUser.length > 0) {\n    return { success: false, error: \"User already exists\" };\n  }\n\n  const hashedPassword = await hash(password, 10);\n\n  try {\n    await db.insert(users).values({\n      fullName,\n      email,\n      universityId,\n      password: hashedPassword,\n      universityCard,\n    });\n\n    {/**await workflowClient.trigger({\n      url: `${config.env.prodApiEndpoint}/api/workflows/onboarding`,\n      body: {\n        email,\n        fullName,\n      },\n    });*/}\n\n    await signInWithCredentials({ email, password });\n\n    return { success: true };\n  } catch (error) {\n    console.log(error, \"Signup error\");\n    return { success: false, error: \"Signup error\" };\n  }\n};\n"],"names":[],"mappings":";;;;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAAA;AAPA;;;;;;;;;;;AAWO,MAAM,uCAAmB,GAAnB,wBAAwB,OACnC;IAEA,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;IAE5B,MAAM,KAAK,CAAC,MAAM,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,sBAAsB;IACvD,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,gHAAA,CAAA,UAAS,CAAC,KAAK,CAAC;IAE1C,IAAI,CAAC,SAAS,OAAO,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD,EAAE;IAE9B,IAAI;QACF,MAAM,SAAS,MAAM,CAAA,GAAA,oGAAA,CAAA,SAAM,AAAD,EAAE,eAAe;YACzC;YACA;YACA,UAAU;QACZ;QAEA,IAAI,QAAQ,OAAO;YACjB,OAAO;gBAAE,SAAS;gBAAO,OAAO,OAAO,KAAK;YAAC;QAC/C;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,OAAO;QACnB,OAAO;YAAE,SAAS;YAAO,OAAO;QAAe;IACjD;AACF;AAEO,MAAM,uCAAI,GAAJ,SAAS,OAAO;IAC3B,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,YAAY,EAAE,QAAQ,EAAE,cAAc,EAAE,GAAG;IAEpE,MAAM,KAAK,CAAC,MAAM,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,sBAAsB;IACvD,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,gHAAA,CAAA,UAAS,CAAC,KAAK,CAAC;IAE1C,IAAI,CAAC,SAAS,OAAO,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD,EAAE;IAE9B,MAAM,eAAe,MAAM,mHAAA,CAAA,KAAE,CAC1B,MAAM,GACN,IAAI,CAAC,kHAAA,CAAA,QAAK,EACV,KAAK,CAAC,CAAA,GAAA,kKAAA,CAAA,KAAE,AAAD,EAAE,kHAAA,CAAA,QAAK,CAAC,KAAK,EAAE,QACtB,KAAK,CAAC;IAET,IAAI,aAAa,MAAM,GAAG,GAAG;QAC3B,OAAO;YAAE,SAAS;YAAO,OAAO;QAAsB;IACxD;IAEA,MAAM,iBAAiB,MAAM,CAAA,GAAA,iIAAA,CAAA,OAAI,AAAD,EAAE,UAAU;IAE5C,IAAI;QACF,MAAM,mHAAA,CAAA,KAAE,CAAC,MAAM,CAAC,kHAAA,CAAA,QAAK,EAAE,MAAM,CAAC;YAC5B;YACA;YACA;YACA,UAAU;YACV;QACF;QAEA,CAMK;QAEL,MAAM,sBAAsB;YAAE;YAAO;QAAS;QAE9C,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,OAAO;QACnB,OAAO;YAAE,SAAS;YAAO,OAAO;QAAe;IACjD;AACF;;;IAxEa;IA4BA;;AA5BA,+OAAA;AA4BA,+OAAA"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}